var De=Object.defineProperty,be=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Z=(_,s,c)=>s in _?De(_,s,{enumerable:!0,configurable:!0,writable:!0,value:c}):_[s]=c,ee=(_,s)=>{for(var c in s||(s={}))xe.call(s,c)&&Z(_,c,s[c]);if(Q)for(var c of Q(s))Be.call(s,c)&&Z(_,c,s[c]);return _},te=(_,s)=>be(_,Fe(s));import{s as qe,e as Ee,n as Re,m as we,i as $e,l as Ne,q as Se,r as Te,d as f}from"./element-plus-978032fc.js";import{_ as He,a as ze,b as Me}from"./index-5ba76d30.js";import{u as B,c as ae,g as Pe,f as se,r as k}from"./index-e80b1955.js";import{u as Ve}from"./vue-router-9467f4ca.js";import{u as Le}from"./vuex-a79d8c7c.js";import{E as le}from"./@tinymce-d9c43e5a.js";import{A as Ue,B as Ae}from"./@element-plus-ed130b8d.js";import{d as Ie,y as oe,r as N,_ as re,o as h,c as q,U as n,S as o,u,R as E,O as b,a as i,X as ne,a2 as F,W as v,P as je,a7 as Ye}from"./@vue-a3b8ecb2.js";import"./@vueuse-972b0b46.js";import"./@ctrl-eb0b847c.js";import"./lodash-es-8dd21e31.js";import"./async-validator-1193b133.js";import"./@popperjs-892fd7f5.js";import"./axios-eec2155c.js";import"./mitt-dab1f1cb.js";const Ge={class:"detail-body"},Oe=F("\u7F16\u8F91\u8BDD\u9898"),We={class:"my-topic"},Xe={class:"topic-title"},Je={class:"title-left"},Ke={class:"topic-title-desc"},Qe={class:"title-right"},Ze=["innerHTML"],et=i("span",{class:"card-replies-title"},"\u56DE\u590D",-1),tt={class:"replie-user-img"},at={class:"replie-title"},st={class:"replie-up"},lt=["onClick"],ot={key:0},rt=["onClick"],nt={class:"replie-desc"},it=["innerHTML"],ut=F("\u56DE\u590D"),ct=F("\u53D6\u6D88"),pt=i("span",{class:"card-replies-title"},"\u6DFB\u52A0\u56DE\u590D",-1),dt=F("\u56DE\u590D"),Rt=Ie({setup(_){const s=Ve(),{state:c}=Le(),S={height:200,width:"100%",language_url:"/vue-vite-cnode/./tinymce-langs/zh_CN.js",language:"zh_CN",browser_spellcheck:!0,branding:!1,elementpath:!0,statusbar:!0,paste_data_images:!0,menubar:!1,fontsize_formats:"14px 16px 18px 20px 24px 26px 28px 30px 32px 36px",font_formats:"\u5FAE\u8F6F\u96C5\u9ED1=Microsoft YaHei,Helvetica Neue;PingFang SC;sans-serif;\u82F9\u679C\u82F9\u65B9=PingFang SC,Microsoft YaHei,sans-serif;\u5B8B\u4F53=simsun;serifsans-serif;Terminal=terminal;monaco;Times New Roman=times new roman;times",file_picker_types:"image",images_upload_credentials:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"fontselect fontsizeselect link lineheight forecolor backcolor bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | image quicklink h2 h3 blockquote table numlist bullist preview fullscreen"},ie=oe(()=>c.user.token),ue=oe(()=>c.user.simpleUserData.loginname),{isLoading:T,adornUrl:y,httpRequest:ce}=B(),e=N(),R=()=>{ce({url:y(`/api/v1/topic/${s.query.id}`),method:"get",params:{mdrender:!0,accesstoken:c.user.token||""}}).then(({data:t})=>{t.data.content=ae(t.data.content),t.data.replies.forEach(a=>{a.content=ae(a.content),a.isReplie=!1,a.formRef=N(),a.replieContent=""}),e.value=t.data}).catch(t=>{f.error("\u8BF7\u6C42\u5931\u8D25"),console.error(t)})};R();const pe=()=>{s.query.listParm?k({name:"index",params:{listParm:String(s.query.listParm)}}):s.query.userName?k(`/user/${s.query.userName}`):k("/collect")},de=()=>{var t,a,r;s.query.userName?k({path:`/edit-topic/${(t=e.value)==null?void 0:t.id}`,query:{userName:s.query.userName}}):s.query.listParm?k({path:`/edit-topic/${(a=e.value)==null?void 0:a.id}`,query:{listParm:String(s.query.listParm)}}):k(`/edit-topic/${(r=e.value)==null?void 0:r.id}`)},{httpRequest:H}=B(),_e=()=>{e.value&&e.value.is_collect?fe():me()},me=()=>{H({url:y("/api/v1/topic_collect/collect"),method:"post",data:{topic_id:e.value&&e.value.id,accesstoken:localStorage.getItem("token")||""}}).then(()=>{e.value&&(e.value.is_collect=!0),f.success("\u6536\u85CF\u6210\u529F")}).catch(t=>{f.error("\u8BF7\u6C42\u5931\u8D25"),console.error(t)})},fe=()=>{H({url:y("/api/v1/topic_collect/de_collect"),method:"post",data:{topic_id:e.value&&e.value.id,accesstoken:localStorage.getItem("token")||""}}).then(()=>{e.value&&(e.value.is_collect=!1),f.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F")}).catch(t=>{f.error("\u8BF7\u6C42\u5931\u8D25"),console.error(t)})},{httpRequest:he}=B(),ve=t=>{he({url:y(`/api/v1/reply/${t}/ups`),method:"post",data:{accesstoken:localStorage.getItem("token")||""}}).then(({data:a})=>{a.action==="up"?f.success("\u70B9\u8D5E\u6210\u529F"):f.success("\u53D6\u6D88\u70B9\u8D5E\u6210\u529F"),R()}).catch(a=>{const{data:r}=a.response;if(r.error_msg){f.error(r.error_msg);return}f.error("\u8BF7\u6C42\u5931\u8D25"),console.error(a)})},z=N(),C=re({id:void 0,content:""}),M=re({content:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9",trigger:"blur"}],replieContent:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9",trigger:"blur"}]}),{httpRequest:ge}=B(),P=async(t,a,r)=>{!t||await t.validate((p,w)=>{p?ke(a,r):console.log("error submit!",w)})},ke=(t,a)=>{var r;ge({url:y(`/api/v1/topic/${(r=e.value)==null?void 0:r.id}/replies`),method:"post",data:{accesstoken:localStorage.getItem("token")||"",content:a!=null?a:C.content,reply_id:t}}).then(()=>{C.content="",R()}).catch(p=>{f.error("\u8BF7\u6C42\u5931\u8D25"),console.error(p)})},V=t=>{var a;if(e.value){const r=(a=e.value)==null?void 0:a.replies,p=r[t].author.loginname;r[t].isReplie=!r[t].isReplie,r[t].replieContent=r[t].isReplie?`<div class="markdown-text"><p><a href="/user/${p}">@${p}</a>&nbsp;</p></div>`:"",e.value=te(ee({},e.value),{replies:r})}};return(t,a)=>{const r=qe,p=Ee,w=Re,ye=we,$=$e,Ce=Ne,x=Se,L=Te;return h(),q("div",Ge,[n(He,null,{right:o(()=>{var D;return[n(ze,{title:"\u4F5C\u8005",authorData:(D=e.value)==null?void 0:D.author,authorLoading:u(T)},null,8,["authorData","authorLoading"]),n(Me)]}),default:o(()=>{var D,U;return[n($,{class:"box-card"},{header:o(()=>{var d;return[n(r,{class:"card-title",onBack:pe,content:"\u8BDD\u9898\u8BE6\u60C5"}),u(ue)===((d=e.value)==null?void 0:d.author.loginname)?(h(),E(p,{key:0,class:"edit-topic-btn",type:"primary",onClick:de},{default:o(()=>[Oe]),_:1})):b("",!0)]}),default:o(()=>{var d;return[i("span",We,[n(ye,{class:"detail-skeleton",loading:u(T),animated:"",rows:20},{default:o(()=>{var l,g,m,A,I,j,Y,G,O,W,X;return[i("div",Xe,[i("div",Je,[i("div",{class:"topic-title-tab",style:ne({width:!((l=e.value)!=null&&l.top)&&((g=e.value)==null?void 0:g.tab)==="dev"?"":"50px"})},[n(w,{effect:"dark",type:(m=e.value)!=null&&m.top?"danger":"success"},{default:o(()=>{var J,K;return[F(v(u(Pe)((J=e.value)==null?void 0:J.top,(K=e.value)==null?void 0:K.tab)),1)]}),_:1},8,["type"])],4),i("div",{class:"title-name",style:ne({width:!((A=e.value)!=null&&A.top)&&((I=e.value)==null?void 0:I.tab)==="dev"?"":"calc(100% - 50px)"})},v((j=e.value)==null?void 0:j.title),5),i("div",Ke,[i("span",null,v("\u25CF "+u(se)(((Y=e.value)==null?void 0:Y.create_at)||"","yyyy-MM-dd")),1),i("span",null,v("\u25CF "+(((G=e.value)==null?void 0:G.author)&&((O=e.value)==null?void 0:O.author.loginname)?(W=e.value)==null?void 0:W.author.loginname:"")),1)])]),i("div",Qe,[u(ie)?(h(),E(p,{key:0,circle:"",plain:"",size:"large",type:"warning",icon:(X=e.value)!=null&&X.is_collect?u(Ue):u(Ae),onClick:_e},null,8,["icon"])):b("",!0)])])]}),_:1},8,["loading"]),i("div",{class:"topic-content",innerHTML:(d=e.value)==null?void 0:d.content},null,8,Ze)])]}),_:1}),((D=e.value)==null?void 0:D.replies)&&((U=e.value.replies)==null?void 0:U.length)>0?(h(),E($,{key:0,class:"box-card"},{header:o(()=>[et]),default:o(()=>{var d;return[(h(!0),q(je,null,Ye((d=e.value)==null?void 0:d.replies,(l,g)=>(h(),q("div",{key:g,class:"replie-item"},[i("div",tt,[n(Ce,{shape:"square",size:40,src:l.author.avatar_url},null,8,["src"])]),i("div",at,v(l.author.loginname+"\u56DE\u590D\u4E86\u60A8\u7684\u8BDD\u9898"),1),i("div",st,[i("div",{class:"icon up-icon",onClick:m=>ve(l.id)},null,8,lt),l.ups.length?(h(),q("span",ot,v(l.ups.length),1)):b("",!0)]),i("div",{class:"icon replie-icon",onClick:m=>V(g)},null,8,rt),i("div",nt,v(u(se)(l.create_at,"yyyy-MM-dd")),1),i("div",{class:"replie-content",innerHTML:l==null?void 0:l.content},null,8,it),l.isReplie?(h(),E(L,{key:0,ref_for:!0,ref:m=>l.formRef=m,class:"replies-form replie-edit-wrapper",model:l,rules:u(M),"label-width":"0"},{default:o(()=>[n(x,{label:"",prop:"replieContent"},{default:o(()=>[n(u(le),{"api-key":"mh2f2ffdlr2zzaky3yk52tx8rtxrxnbt1a6p7p7jx96hy70r",init:S,modelValue:l.replieContent,"onUpdate:modelValue":m=>l.replieContent=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(x,{class:"is-last"},{default:o(()=>[n(p,{type:"primary",onClick:m=>P(l.formRef,l.id,l.replieContent)},{default:o(()=>[ut]),_:2},1032,["onClick"]),n(p,{onClick:m=>V(g)},{default:o(()=>[ct]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model","rules"])):b("",!0)]))),128))]}),_:1})):b("",!0),n($,{class:"box-card"},{header:o(()=>[pt]),default:o(()=>[n(L,{ref_key:"form",ref:z,class:"replies-form",model:u(C),rules:u(M),"label-width":"0"},{default:o(()=>[n(x,{label:"",prop:"content"},{default:o(()=>[n(u(le),{"api-key":"mh2f2ffdlr2zzaky3yk52tx8rtxrxnbt1a6p7p7jx96hy70r",init:S,modelValue:u(C).content,"onUpdate:modelValue":a[0]||(a[0]=d=>u(C).content=d)},null,8,["modelValue"])]),_:1}),n(x,{class:"is-last"},{default:o(()=>[n(p,{type:"primary",onClick:a[1]||(a[1]=d=>P(z.value))},{default:o(()=>[dt]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]}),_:1})])}}});export{Rt as default};
