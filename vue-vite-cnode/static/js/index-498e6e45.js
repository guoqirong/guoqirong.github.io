import{_ as A,U as ee,C as te}from"./index-de5dcdad.js";import{f as j,s as W,d as Y,m as G,k as O,p as Q,q as X,n as oe,e as n}from"./element-plus-087faedc.js";import{_ as se,u as B,f as ae,g as le,c as V,r as v}from"./index-6ed5d7bd.js";import{u as re}from"./vue-router-9467f4ca.js";import{u as ie}from"./vuex-a79d8c7c.js";import{E as ne}from"./@tinymce-d9c43e5a.js";import{A as ce,B as ue}from"./@element-plus-2403d92f.js";import{d as pe,y as de,r as N,_ as U,c as q,U as r,S as l,Z as H,o as d,R,O as y,a as i,X as I,a2 as C,W as m,P as me,a7 as _e}from"./@vue-a3b8ecb2.js";import"./@vueuse-972b0b46.js";import"./@ctrl-eb0b847c.js";import"./lodash-es-8dd21e31.js";import"./async-validator-1193b133.js";import"./@popperjs-892fd7f5.js";import"./axios-eec2155c.js";import"./vite-plugin-qiankun-075a3e44.js";import"./mitt-dab1f1cb.js";const fe=pe({components:{ElCard:j,ElPageHeader:W,ElButton:Y,ElAvatar:G,ElSkeleton:O,ElForm:Q,ElFormItem:X,Editor:ne,PageWrapper:A,UserInfoComp:ee,ClientQrCodeComp:te},setup(){const e=re(),{state:p}=ie(),z={height:200,width:"100%",language_url:"/vue-vite-cnode/./tinymce-langs/zh_CN.js",language:"zh_CN",browser_spellcheck:!0,branding:!1,elementpath:!0,statusbar:!0,paste_data_images:!0,menubar:!1,fontsize_formats:"14px 16px 18px 20px 24px 26px 28px 30px 32px 36px",font_formats:"\u5FAE\u8F6F\u96C5\u9ED1=Microsoft YaHei,Helvetica Neue;PingFang SC;sans-serif;\u82F9\u679C\u82F9\u65B9=PingFang SC,Microsoft YaHei,sans-serif;\u5B8B\u4F53=simsun;serifsans-serif;Terminal=terminal;monaco;Times New Roman=times new roman;times",file_picker_types:"image",images_upload_credentials:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"fontselect fontsizeselect link lineheight forecolor backcolor bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | image quicklink h2 h3 blockquote table numlist bullist preview fullscreen"},L=de(()=>p.user.simpleUserData.loginname),{isLoading:M,adornUrl:_,httpRequest:E}=B(),t=N(),h=()=>{E({url:_(`/api/v1/topic/${e.query.id}`),method:"get",params:{mdrender:!0,accesstoken:p.user.token||""}}).then(({data:o})=>{o.data.content=V(o.data.content),o.data.replies.forEach(a=>{a.content=V(a.content),a.isReplie=!1,a.formRef=N(),a.replieContent=""}),t.value=o.data}).catch(o=>{n.error("\u8BF7\u6C42\u5931\u8D25"),console.error(o)})};h();const S=()=>{e.query.listParm?v({name:"index",params:{listParm:String(e.query.listParm)}}):e.query.userName?v(`/user/${e.query.userName}`):v("/collect")},g=()=>{e.query.userName?v({path:`/edit-topic/${t.value?.id}`,query:{userName:e.query.userName}}):v({path:`/edit-topic/${t.value?.id}`,query:{listParm:String(e.query.listParm)}})},{httpRequest:D}=B(),F=()=>{t.value&&t.value.is_collect?b():f()},f=()=>{D({url:_("/api/v1/topic_collect/collect"),method:"post",data:{topic_id:t.value&&t.value.id,accesstoken:localStorage.getItem("token")||""}}).then(()=>{t.value&&(t.value.is_collect=!0),n.success("\u6536\u85CF\u6210\u529F")}).catch(o=>{n.error("\u8BF7\u6C42\u5931\u8D25"),console.error(o)})},b=()=>{D({url:_("/api/v1/topic_collect/de_collect"),method:"post",data:{topic_id:t.value&&t.value.id,accesstoken:localStorage.getItem("token")||""}}).then(()=>{t.value&&(t.value.is_collect=!1),n.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F")}).catch(o=>{n.error("\u8BF7\u6C42\u5931\u8D25"),console.error(o)})},{httpRequest:w}=B(),T=o=>{w({url:_(`/api/v1/reply/${o}/ups`),method:"post",data:{accesstoken:localStorage.getItem("token")||""}}).then(({data:a})=>{a.action==="up"?n.success("\u70B9\u8D5E\u6210\u529F"):n.success("\u53D6\u6D88\u70B9\u8D5E\u6210\u529F"),h()}).catch(a=>{const{data:u}=a.response;if(u.error_msg){n.error(u.error_msg);return}n.error("\u8BF7\u6C42\u5931\u8D25"),console.error(a)})},$=N(),s=U({id:void 0,content:""}),k=U({content:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9",trigger:"blur"}],replieContent:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9",trigger:"blur"}]}),{httpRequest:c}=B(),Z=async(o,a,u)=>{!o||await o.validate((K,x)=>{K?P(a,u):console.log("error submit!",x)})},P=(o,a)=>{c({url:_(`/api/v1/topic/${t.value?.id}/replies`),method:"post",data:{accesstoken:localStorage.getItem("token")||"",content:a??s.content,reply_id:o}}).then(()=>{s.content="",h()}).catch(u=>{n.error("\u8BF7\u6C42\u5931\u8D25"),console.error(u)})},J=o=>{if(t.value){const a=t.value?.replies,u=a[o].author.loginname;a[o].isReplie=!a[o].isReplie,a[o].replieContent=a[o].isReplie?`<div class="markdown-text"><p><a href="/user/${u}">@${u}</a>&nbsp;</p></div>`:"",t.value={...t.value,replies:a}}};return{userName:L,editTopic:g,topic:t,isLoading:M,token:p.user.token,Star:ce,StarFilled:ue,formatDate:ae,getTopicTab:le,goBack:S,collectClick:F,likeAndUnlike:T,init:z,form:$,topicReplieForm:s,rules:k,replieTopic:Z,changeRepliceItemState:J,replieTopicRequest:P}}}),he={class:"detail-body"},ge=C("\u7F16\u8F91\u8BDD\u9898"),ke={class:"my-topic"},ve={class:"topic-title"},ye={class:"title-left"},Ce={class:"topic-title-desc"},De={class:"title-right"},Fe=["innerHTML"],be=i("span",{class:"card-replies-title"},"\u56DE\u590D",-1),Be={class:"replie-user-img"},qe={class:"replie-title"},Re={class:"replie-up"},Ee=["onClick"],Se={key:0},we=["onClick"],Te={class:"replie-desc"},$e=["innerHTML"],Ne=C("\u56DE\u590D"),He=C("\u53D6\u6D88"),ze=i("span",{class:"card-replies-title"},"\u6DFB\u52A0\u56DE\u590D",-1),Le=C("\u56DE\u590D");function Me(e,p,z,L,M,_){const E=W,t=Y,h=oe,S=O,g=j,D=G,F=H("editor"),f=X,b=Q,w=H("user-info-comp"),T=H("client-qr-code-comp"),$=A;return d(),q("div",he,[r($,null,{right:l(()=>[r(w,{title:"\u4F5C\u8005",authorData:e.topic?.author,authorLoading:e.isLoading},null,8,["authorData","authorLoading"]),r(T)]),default:l(()=>[r(g,{class:"box-card"},{header:l(()=>[r(E,{class:"card-title",onBack:e.goBack,content:"\u8BDD\u9898\u8BE6\u60C5"},null,8,["onBack"]),e.userName===e.topic?.author.loginname?(d(),R(t,{key:0,class:"edit-topic-btn",type:"primary",onClick:e.editTopic},{default:l(()=>[ge]),_:1},8,["onClick"])):y("",!0)]),default:l(()=>[i("span",ke,[r(S,{class:"detail-skeleton",loading:e.isLoading,animated:"",rows:20},{default:l(()=>[i("div",ve,[i("div",ye,[i("div",{class:"topic-title-tab",style:I({width:!e.topic?.top&&e.topic?.tab==="dev"?"":"50px"})},[r(h,{effect:"dark",type:e.topic?.top?"danger":"success"},{default:l(()=>[C(m(e.getTopicTab(e.topic?.top,e.topic?.tab)),1)]),_:1},8,["type"])],4),i("div",{class:"title-name",style:I({width:!e.topic?.top&&e.topic?.tab==="dev"?"":"calc(100% - 50px)"})},m(e.topic?.title),5),i("div",Ce,[i("span",null,m("\u25CF "+e.formatDate(e.topic?.create_at||"","yyyy-MM-dd")),1),i("span",null,m("\u25CF "+(e.topic?.author&&e.topic?.author.loginname?e.topic?.author.loginname:"")),1)])]),i("div",De,[e.token?(d(),R(t,{key:0,circle:"",plain:"",size:"large",type:"warning",icon:e.topic?.is_collect?e.StarFilled:e.Star,onClick:e.collectClick},null,8,["icon","onClick"])):y("",!0)])])]),_:1},8,["loading"]),i("div",{class:"topic-content",innerHTML:e.topic?.content},null,8,Fe)])]),_:1}),e.topic?.replies&&e.topic.replies?.length>0?(d(),R(g,{key:0,class:"box-card"},{header:l(()=>[be]),default:l(()=>[(d(!0),q(me,null,_e(e.topic?.replies,(s,k)=>(d(),q("div",{key:k,class:"replie-item"},[i("div",Be,[r(D,{shape:"square",size:40,src:s.author.avatar_url},null,8,["src"])]),i("div",qe,m(s.author.loginname+"\u56DE\u590D\u4E86\u60A8\u7684\u8BDD\u9898"),1),i("div",Re,[i("div",{class:"icon up-icon",onClick:c=>e.likeAndUnlike(s.id)},null,8,Ee),s.ups.length?(d(),q("span",Se,m(s.ups.length),1)):y("",!0)]),i("div",{class:"icon replie-icon",onClick:c=>e.changeRepliceItemState(k)},null,8,we),i("div",Te,m(e.formatDate(s.create_at,"yyyy-MM-dd")),1),i("div",{class:"replie-content",innerHTML:s?.content},null,8,$e),s.isReplie?(d(),R(b,{key:0,ref_for:!0,ref:c=>s.formRef=c,class:"replies-form replie-edit-wrapper",model:s,rules:e.rules,"label-width":"0"},{default:l(()=>[r(f,{label:"",prop:"replieContent"},{default:l(()=>[r(F,{"api-key":"mh2f2ffdlr2zzaky3yk52tx8rtxrxnbt1a6p7p7jx96hy70r",init:e.init,modelValue:s.replieContent,"onUpdate:modelValue":c=>s.replieContent=c},null,8,["init","modelValue","onUpdate:modelValue"])]),_:2},1024),r(f,{class:"is-last"},{default:l(()=>[r(t,{type:"primary",onClick:c=>e.replieTopic(s.formRef,s.id,s.replieContent)},{default:l(()=>[Ne]),_:2},1032,["onClick"]),r(t,{onClick:c=>e.changeRepliceItemState(k)},{default:l(()=>[He]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model","rules"])):y("",!0)]))),128))]),_:1})):y("",!0),r(g,{class:"box-card"},{header:l(()=>[ze]),default:l(()=>[r(b,{ref:"form",class:"replies-form",model:e.topicReplieForm,rules:e.rules,"label-width":"0"},{default:l(()=>[r(f,{label:"",prop:"content"},{default:l(()=>[r(F,{"api-key":"mh2f2ffdlr2zzaky3yk52tx8rtxrxnbt1a6p7p7jx96hy70r",init:e.init,modelValue:e.topicReplieForm.content,"onUpdate:modelValue":p[0]||(p[0]=s=>e.topicReplieForm.content=s)},null,8,["init","modelValue"])]),_:1}),r(f,{class:"is-last"},{default:l(()=>[r(t,{type:"primary",onClick:p[1]||(p[1]=s=>e.replieTopic(e.form))},{default:l(()=>[Le]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})])}var et=se(fe,[["render",Me]]);export{et as default};
