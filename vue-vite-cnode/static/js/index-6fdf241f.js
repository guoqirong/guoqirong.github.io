import{_ as w,a as N,b as S}from"./index-5ba76d30.js";import{e as V,l as z,o as O,m as U,i as G,d as v}from"./element-plus-978032fc.js";import{u as C,c as M,f as x,b as P}from"./index-e80b1955.js";import{u as W}from"./vuex-a79d8c7c.js";import{d as j,y as I,r as J,o,c as u,U as c,S as r,R as _,O as K,P as A,a7 as L,u as i,a as s,a2 as b,W as l}from"./@vue-a3b8ecb2.js";import"./vue-router-9467f4ca.js";import"./@vueuse-972b0b46.js";import"./@element-plus-ed130b8d.js";import"./@ctrl-eb0b847c.js";import"./lodash-es-8dd21e31.js";import"./async-validator-1193b133.js";import"./@popperjs-892fd7f5.js";import"./axios-eec2155c.js";import"./mitt-dab1f1cb.js";const Q={class:"my-message"},X=s("span",{class:"card-title"},"\u672A\u8BFB\u4FE1\u606F",-1),Y=b("\u5168\u90E8\u5DF2\u8BFB"),Z={class:"user-img"},ee={class:"read-messages-title"},se={class:"title"},ae={class:"desc"},te={class:"read-btn"},oe=b("\u5DF2\u8BFB"),re=["innerHTML"],ne={class:"topic-title"},ce=s("span",{class:"card-title"},"\u5DF2\u8BFB\u4FE1\u606F",-1),le={class:"user-img"},ue={class:"read-messages-title"},_e={class:"title"},de={class:"desc"},ie=["innerHTML"],me={class:"topic-title"},be=j({setup(pe){const{state:q}=W(),d=I(()=>q.user.token),{isLoading:g,adornUrl:m,httpRequest:H}=C(),a=J(),p=()=>{d.value&&H({url:m("/api/v1/messages"),method:"get",params:{accesstoken:d.value,mdrender:!0}}).then(({data:t})=>{t.data.has_read_messages.forEach(n=>{n.reply.content=M(n.reply.content)}),t.data.hasnot_read_messages.forEach(n=>{n.reply.content=M(n.reply.content)}),a.value=t.data}).catch(t=>{v.error("\u8BF7\u6C42\u5931\u8D25"),console.error(t)})};p();const[y]=P(),{httpRequest:f}=C(),R=()=>{f({url:m("/api/v1/message/mark_all"),method:"post",params:{accesstoken:d.value}}).then(()=>{y.emit("read-msg"),p()}).catch(t=>{v.error("\u8BF7\u6C42\u5931\u8D25"),console.error(t)})},T=t=>{f({url:m(`/api/v1/message/mark_one/${t}`),method:"post",params:{accesstoken:d.value}}).then(()=>{y.emit("read-msg"),p()}).catch(n=>{v.error("\u8BF7\u6C42\u5931\u8D25"),console.error(n)})};return(t,n)=>{const k=V,E=z,B=O,D=U,F=G,$=w;return o(),u("div",Q,[c($,null,{right:r(()=>[c(N),c(S)]),default:r(()=>[c(F,{class:"box-card"},{header:r(()=>[X,a.value&&a.value.hasnot_read_messages&&a.value.hasnot_read_messages.length>0?(o(),_(k,{key:0,class:"all-read",onClick:R},{default:r(()=>[Y]),_:1})):K("",!0)]),default:r(()=>[c(D,{class:"message-skeleton",loading:i(g),animated:"",rows:6},{default:r(()=>[a.value&&a.value.hasnot_read_messages&&a.value.hasnot_read_messages.length>0?(o(!0),u(A,{key:0},L(a.value.hasnot_read_messages,(e,h)=>(o(),u("div",{key:h,class:"notread-item"},[s("div",Z,[(o(),_(E,{shape:"square",size:40,src:e.author.avatar_url,key:e.author.avatar_url,alt:e.author.loginname},null,8,["src","alt"]))]),s("div",ee,[s("div",se,l(e.author.loginname+"\u56DE\u590D\u4E86\u60A8\u7684\u8BDD\u9898"),1),s("div",ae,l(i(x)(e.create_at,"yyyy-MM-dd")),1)]),s("div",te,[c(k,{onClick:he=>T(e.id)},{default:r(()=>[oe]),_:2},1032,["onClick"])]),s("div",{class:"reply-content",innerHTML:e.reply.content},null,8,re),s("div",ne,"\u8BDD\u9898\uFF1A"+l(e.topic.title),1)]))),128)):(o(),_(B,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["loading"])]),_:1}),c(F,{class:"box-card"},{header:r(()=>[ce]),default:r(()=>[c(D,{class:"message-skeleton",loading:i(g),animated:"",rows:6},{default:r(()=>[a.value&&a.value.has_read_messages&&a.value.has_read_messages.length>0?(o(!0),u(A,{key:0},L(a.value.has_read_messages,(e,h)=>(o(),u("div",{key:h,class:"read-item"},[s("div",le,[(o(),_(E,{shape:"square",size:40,src:e.author.avatar_url,key:e.author.avatar_url,alt:e.author.loginname},null,8,["src","alt"]))]),s("div",ue,[s("div",_e,l(e.author.loginname+"\u56DE\u590D\u4E86\u60A8\u7684\u8BDD\u9898"),1),s("div",de,l(i(x)(e.create_at,"yyyy-MM-dd")),1)]),s("div",{class:"reply-content",innerHTML:e.reply.content},null,8,ie),s("div",me,"\u8BDD\u9898\uFF1A"+l(e.topic.title),1)]))),128)):(o(),_(B,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["loading"])]),_:1})]),_:1})])}}});export{be as default};
